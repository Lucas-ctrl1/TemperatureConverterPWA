<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2" />
    <title>Temperature converter</title>
    
    <!-- CSS and Manifest -->
    <link rel="stylesheet" href="converter.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <h1>Temperature converter</h1>

    <form id="converter">
        <label for="input-temp">temperature</label>
        <input type="text" id="input-temp" name="input-temp" value="20" />
        <label for="input-unit">from</label>
        <select id="input-unit" name="input-unit">
            <option value="c" selected>Celsius</option>
            <option value="f">Fahrenheit</option>
            <option value="k">Kelvin</option>
        </select>
        <label for="output-unit">to</label>
        <select id="output-unit" name="output-unit">
            <option value="c">Celsius</option>
            <option value="f" selected>Fahrenheit</option>
            <option value="k">Kelvin</option>
        </select>
        <output name="output-temp" id="output-temp" for="input-temp input-unit output-unit">68 F</output>
    </form>

    <script src="converter.js"></script>
    
    <!-- Service Worker & Install Handler -->
    <script>
    // Service Worker Registration
    if('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js')
            .then(registration => {
                console.log('âœ… Service Worker registered successfully:', registration);
                return registration.update();
            })
            .then(() => {
                console.log('âœ… Service Worker updated');
                return navigator.serviceWorker.ready;
            })
            .then(registration => {
                console.log('âœ… Service Worker is controlling the page');
            })
            .catch(error => {
                console.log('âŒ Service Worker registration failed:', error);
            });
    }

    // Install Prompt Handler
    let deferredPrompt;
    let installButton;

    window.addEventListener('beforeinstallprompt', (e) => {
        console.log('ğŸ¯ beforeinstallprompt event fired!');
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later
        deferredPrompt = e;
        
        // Create and show install button
        installButton = document.createElement('button');
        installButton.innerHTML = 'ğŸ“± INSTALL APP';
        installButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            background: #2f3d58;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 10000;
            transition: all 0.3s ease;
        `;
        
        installButton.onmouseover = function() {
            this.style.background = '#1e2a3f';
            this.style.transform = 'scale(1.05)';
        };
        
        installButton.onmouseout = function() {
            this.style.background = '#2f3d58';
            this.style.transform = 'scale(1)';
        };
        
        installButton.onclick = async () => {
            if (!deferredPrompt) {
                console.log('No deferred prompt available');
                return;
            }
            
            console.log('ğŸš€ Showing install prompt...');
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response: ${outcome}`);
            
            if (outcome === 'accepted') {
                console.log('âœ… User accepted the install');
                installButton.style.display = 'none';
            } else {
                console.log('âŒ User dismissed the install');
            }
            
            // Clear the saved prompt since it can't be used again
            deferredPrompt = null;
        };
        
        document.body.appendChild(installButton);
        console.log('âœ… Install button added to page');
    });

    window.addEventListener('appinstalled', (evt) => {
        console.log('ğŸ‰ PWA was successfully installed!');
        if (installButton) {
            installButton.style.display = 'none';
        }
        deferredPrompt = null;
    });

    // Debug info
    console.log('ğŸ PWA setup complete');
    console.log('Manifest:', document.querySelector('link[rel="manifest"]'));
    console.log('Service Worker support:', 'serviceWorker' in navigator);
    </script>
</body>
</html>